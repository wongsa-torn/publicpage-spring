<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">


<head>
    <meta charset="UTF-8">
    <meta th:name="'_csrf'" th:content="${_csrf.token}">
    <meta th:name="'_csrf_header'" th:content="${_csrf.headerName}" />
    <title>Departure Page</title>
    <link th:href="@{/main.css}" rel="stylesheet" />
    <style>
        tbody {
            scroll-behavior: smooth;
        }
    </style>
    <style>
        /* ‡∏ã‡πà‡∏≠‡∏ô scrollbar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö tbody */
        #tableBody::-webkit-scrollbar {
            display: none;
        }

        #tableBody {
            -ms-overflow-style: none;
            /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö IE ‡πÅ‡∏•‡∏∞ Edge */
            scrollbar-width: none;
            /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Firefox */
        }
    </style>
    <style>
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            /* IE 10+ */
            scrollbar-width: none;
            /* Firefox */
        }
    </style>

</head>

<body class="bg-gray-100 flex justify-center h-screen">
    <div class="w-full bg-white">

        <!-- <h1>Departure Flights</h1> -->
        <div class="relative h-[7vh]">
            <img class="w-full h-full" th:src="@{'/images/Departure.png'}" alt="Departure">

            <form action="/departure" method="get">
                <input type="hidden" name="type" value="flight" />
                <select name="airportCode" onchange="this.form.submit()"
                    class="absolute top-1.5 right-8 text-[36px] font-bold text-black">
                    <option value="BKK" th:selected="${selectedAirport == 'BKK'}">BKK</option>
                    <option value="DMK" th:selected="${selectedAirport == 'DMK'}">DMK</option>
                    <option value="HKT" th:selected="${selectedAirport == 'HKT'}">HKT</option>
                    <option value="HDY" th:selected="${selectedAirport == 'HDY'}">HDY</option>
                    <option value="CNX" th:selected="${selectedAirport == 'CNX'}">CNX</option>
                    <option value="CEI" th:selected="${selectedAirport == 'CEI'}">CEI</option>
                </select>
            </form>
        </div>


        <!-- Head Section -->
        <div class="sticky top-0 grid grid-cols-12 font-bold text-[30px] bg-[#000033] text-white h-[6vh]">
            <div class="col-span-1 p-2 text-center">Time</div>
            <div class="col-span-1 p-2 text-center">Airlines</div>
            <!-- <div class="col-span-3 p-2 text-left">To</div> -->
            <div th:class="${type == 'flight'} ? 'col-span-3 p-2 text-left' : 'col-span-4 p-2 text-left'">
                To
            </div>
            <div class="col-span-1 p-2 text-center">Flight</div>
            <div class="col-span-1 p-2 text-center">Departs</div>
            <!-- <div class="col-span-1 p-2 text-center">Row</div> -->
            <div class="col-span-1 p-2 text-center" th:if="${type == 'flight'}">
                Row
            </div>
            <div class="col-span-1 p-2 text-center">Gate</div>
            <div class="col-span-3 p-2 text-center">Remark</div>
        </div>

        <!-- Body Section with Scroll -->



        <div class="relative h-[83vh] overflow-hidden"> <!-- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ -->
            <div id="autoScrollContainer" class="h-full overflow-y-auto hide-scrollbar">
                <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô overflow ‡πÄ‡∏õ‡πá‡∏ô auto -->
                <div>
                    <div class="table-body text-[28px]" th:each="departure, iterStat : ${departures}">
                        <div id="scrollArea" class="">
                            <div class="grid grid-cols-12"
                                th:class="${iterStat.index % 2 == 0} ? 'grid grid-cols-12 bg-[#0D4294] text-white' : 'grid grid-cols-12 bg-[#000033] text-white'">
                                <div class="col-span-1 p-2 text-center" th:text="${departure.timeDepart}"></div>
                                <div class="col-span-1 flex items-center">
                                    <img th:src="@{'/images/image/' + ${departure.airline} + '_S.gif'}"
                                        alt="Airline Logo" class="w-[150px] max-h-[40px] h-full"
                                        onerror="this.style.display='none'">
                                </div>
                                <!-- <div class="col-span-3 p-2 flex items-center justify-center"
                                    th:text="${departure.flightTo}"></div> -->
                                <div th:class="${type == 'flight'} ? 'col-span-3 p-2 flex items-center justify-center' : 'col-span-4 p-2 flex items-center justify-center'"
                                    th:text="${departure.flightTo}">
                                </div>
                                <div class="col-span-1 p-2 flex items-center justify-center"
                                    th:text="${departure.flight}">
                                </div>
                                <div class="col-span-1 p-2 flex items-center justify-center"
                                    th:text="${departure.estimate}"></div>
                                <!-- <div class="col-span-1 flex items-center justify-center text-[24px] font-bold">
                                    <span class="text-center rowContainer" th:text="${departure.row}">
                                    </span>
                                </div> -->
                                <div class="col-span-1 flex items-center justify-center text-[24px] font-bold"
                                    th:if="${type == 'flight'}">
                                    <span class="text-center rowContainer" th:text="${departure.row}"></span>
                                </div>
                                <div class="col-span-1 flex items-center justify-center text-[24px] font-bold">
                                    <!-- ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
                                    <span th:if="${departure.gate != null and !departure.gate.isEmpty()}"
                                        class="text-center text-black bg-yellow-500 rounded-lg p-2"
                                        th:text="${departure.gate}">
                                    </span>
                                    <!-- ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
                                    <span th:unless="${departure.gate != null and !departure.gate.isEmpty()}">
                                        <!-- ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á "-" -->
                                    </span>
                                </div>
                                <!-- <div class="col-span-3 remark-container flex justify-center"
                                    th:text="${departure.remark}">
                                </div>
                                <div class="col-span-3 remark-container flex justify-center"
                                    th:text="${departure.statusGate}">
                                </div> -->
                                <div class="col-span-3 remark-container flex justify-center"
                                    th:text="${type == 'flight'} ? ${departure.remark} : ${departure.statusGate}">
                                </div>

                                <div class="py-2 text-center col-start-2 col-span-12"
                                    th:if="${departure.jfnoList != null and !#lists.isEmpty(departure.jfnoList)}">
                                    <div class="mt-2 flex flex-wrap gap-2 justify-start">
                                        <span th:each="jfHtml : ${departure.jfnoList}" th:utext="${jfHtml}"
                                            class="bg-gray-200 text-gray-800 rounded-lg px-3 py-1 text-[20px] font-bold flex items-center">
                                        </span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- <div class="sticky bottom-0">
            <div class="h-[4vh] flex items-center px-4 bg-blue-400">
                <span>Page Last Update On :21/04/2025 10:10 ( Total : 99 )</span>
            </div>
        </div> -->
        <div class="h-[4vh] sticky bottom-0">
            <div class="flex items-center px-4 bg-blue-400 h-full">
                <span>
                    Page Last Update On :
                    <span th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
                    ( Total :
                    <span th:text="${#lists.size(departures)}"></span>
                    )
                </span>
            </div>
        </div>

</body>

<!-- <script>
    document.addEventListener("DOMContentLoaded", function () {

        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö remark ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å backend ‡πÄ‡∏ä‡πà‡∏ô: "Ck-in Close|xxx|DELAYED|yyy|CANCELLED|zzz"
        const remarkContainers = document.querySelectorAll('.remark-container');

        const airportCode = new URLSearchParams(window.location.search).get("airportCode") || "BKK";

        remarkContainers.forEach(function (container) {
            const rawText = container.textContent || container.innerText;
            if (!rawText || rawText.trim() === "") {
                container.innerHTML = ""; // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢
                return;
            }
            const parts = rawText.split('|');
            container.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤

            // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            const selected = [];

            if (airportCode === "BKK") {
                if (parts.length >= 3) {
                    selected.push(parts[0].trim(), parts[2].trim());
                } else if (parts.length >= 1 && parts[0].trim() !== "") {
                    selected.push(parts[0].trim());
                }
            } else if (airportCode === "CNX") {
                if (parts.length >= 4) {
                    selected.push(parts[0].trim(), parts[3].trim());
                } else if (parts.length >= 1 && parts[0].trim() !== "") {
                    selected.push(parts[0].trim());
                }
            } else if (airportCode === "HKT") {
                if (parts.length >= 4) {
                    selected.push(parts[0].trim(), parts[3].trim());
                } else if (parts.length >= 1 && parts[0].trim() !== "") {
                    selected.push(parts[0].trim());
                }
            } else {
                // default: ‡πÅ‡∏™‡∏î‡∏á part ‡πÅ‡∏£‡∏Å‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                if (parts.length >= 1 && parts[0].trim() !== "") {
                    selected.push(parts[0].trim());
                }
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á <span> ‡∏û‡∏£‡πâ‡∏≠‡∏° class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            selected.forEach(function (text) {
                const span = document.createElement('span');
                span.textContent = text;
                span.className = getRemarkClass(text); // ‡πÉ‡∏ä‡πâ Tailwind class
                container.appendChild(span);
                container.appendChild(document.createTextNode(' '));
            });
        });

        function getRemarkClass(text) {
            switch (text) {
                case "Ck-in Close":
                    return "m-2 text-white px-2 py-1 text-[28px]";
                case "DELAYED":
                    return "m-2 bg-white text-black px-2 py-1 rounded text-[28px]";
                case "CANCELLED":
                    return "m-2 bg-blue-500 text-white px-2 py-1 rounded text-[28px]";
                case "Ck-in Open":
                    return "m-2 bg-green-600 text-white px-2 py-1 rounded text-[28px]";
                case "DEPARTED":
                    return "m-2 animate-pulse text-white px-2 py-1 rounded text-[28px]";
                default:
                    return "m-2 text-white px-2 py-1 rounded text-[28px] flex justify-between items-center";
            }
        }
        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡πÜ element ‡∏ó‡∏µ‡πà‡∏°‡∏µ class "rowContainer"
        var rowContainers = document.querySelectorAll('.rowContainer');
        rowContainers.forEach(function (rowContainer) {
            var rowText = rowContainer.textContent || rowContainer.innerText;
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô row ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (rowText.trim().length > 0) {
                var items = rowText.split(',');  // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ,
                rowContainer.innerHTML = '';  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á <span> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏°‡∏≤
                items.forEach(function (item) {
                    var span = document.createElement('span');
                    span.className = "text-center text-black bg-white rounded-lg p-2";
                    span.textContent = item.trim();  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô <span>
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° class ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö <span>
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° class ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                    rowContainer.appendChild(span);  // ‡πÄ‡∏û‡∏¥‡πà‡∏° <span> ‡∏•‡∏á‡πÉ‡∏ô container
                    rowContainer.appendChild(document.createTextNode(' '));  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á <span> ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß
                });
            }
        });
    });

</script>

<script>
    const scrollContainer = document.getElementById('autoScrollContainer');

    const airportCode = new URLSearchParams(window.location.search).get("airportCode") || "BKK";

    const scrollSpeedDown = 200;
    const scrollSpeedUp = 100;

    let direction = 1;
    const delay = 3000;
    let paused = false;

    async function fetchDepartures() {
        try {
            const response = await fetch(`/departure?airportCode=${airportCode}&continue=` + Date.now());
            const html = await response.text();

            // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• table-body ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô response
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newContent = doc.querySelector('.table-body')?.parentElement;

            if (newContent) {
                scrollContainer.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
                scrollContainer.appendChild(newContent);
                console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß');
            }
        } catch (err) {
            console.error('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', err);
        }
    }

    function autoScroll() {
        if (paused) return;
        const maxScroll = scrollContainer.scrollHeight - scrollContainer.clientHeight;
        const currentScroll = scrollContainer.scrollTop;
        if ((direction === 1 && currentScroll >= maxScroll) ||
            (direction === -1 && currentScroll <= 0)) {
            console.log("üõë ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà", currentScroll);
            paused = true;

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á
            if (direction === 1) {
                setTimeout(() => {
                    direction *= -1;
                    paused = false;
                    requestAnimationFrame(autoScroll);
                }, delay);
            } else {
                fetchDepartures().then(() => {
                    setTimeout(() => {
                        direction *= -1;
                        paused = false;
                        requestAnimationFrame(autoScroll);
                    }, delay);
                });
            }
        } else {
            const scrollStep = direction === 1 ? scrollSpeedDown : scrollSpeedUp;
            scrollContainer.scrollTop += direction * scrollStep;
            requestAnimationFrame(autoScroll);
        }
    }
    setTimeout(() => {
        requestAnimationFrame(autoScroll);
    }, delay);
</script> -->

<!-- <script>
    const scrollContainer = document.getElementById('autoScrollContainer');

    // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô pixel ‡∏ï‡πà‡∏≠ frame)
    const scrollSpeedDown = 200; // ‡∏•‡∏á‡πÄ‡∏£‡πá‡∏ß
    const scrollSpeedUp = 200;   // ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡πâ‡∏≤

    let direction = 1; // 1 = ‡∏•‡∏á, -1 = ‡∏Ç‡∏∂‡πâ‡∏ô
    const delay = 3000;
    let paused = false;

    function autoScroll() {
        if (paused) return;

        const maxScroll = scrollContainer.scrollHeight - scrollContainer.clientHeight;
        const currentScroll = scrollContainer.scrollTop;

        if ((direction === 1 && currentScroll >= maxScroll) ||
            (direction === -1 && currentScroll <= 0)) {

            console.log("üõë Paused at", currentScroll);

            paused = true;
            setTimeout(() => {
                direction *= -1; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏¥‡∏®
                paused = false;
                requestAnimationFrame(autoScroll);
            }, delay);
        } else {
            const scrollStep = direction === 1 ? scrollSpeedDown : scrollSpeedUp;
            scrollContainer.scrollTop += direction * scrollStep;
            requestAnimationFrame(autoScroll);
        }
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    setTimeout(() => {
        requestAnimationFrame(autoScroll);
    }, delay);
</script> -->

<script>
    // const airportCode = new URLSearchParams(window.location.search).get("airportCode") || "BKK";
    const params = new URLSearchParams(window.location.search);
    const airportCode = params.get("airportCode") || "BKK";
    const type = params.get("type") || "flight"; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ

    const scrollContainer = document.getElementById('autoScrollContainer');

    const scrollSpeedDown = 0.5;
    const scrollSpeedUp = 1000;
    let direction = 1;
    const delay = 5000;
    let paused = false;

    document.addEventListener("DOMContentLoaded", function () {
        renderRemarksAndRows(); // ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        setTimeout(() => {
            requestAnimationFrame(autoScroll);
        }, delay);
    });

    // async function fetchDepartures() {
    //     try {
    //         const response = await fetch(`/departure?airportCode=${airportCode}&continue=` + Date.now());
    //         const html = await response.text();

    //         const parser = new DOMParser();
    //         const doc = parser.parseFromString(html, 'text/html');
    //         const newContent = doc.querySelector('.table-body')?.parentElement;

    //         if (newContent) {
    //             scrollContainer.innerHTML = '';
    //             scrollContainer.appendChild(newContent);
    //             console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß :', airportCode);

    //             renderRemarksAndRows(); // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
    //         }
    //     } catch (err) {
    //         console.error('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', err);
    //     }
    // }

    async function fetchDepartures() {
        try {
            const response = await fetch(`/departure?airportCode=${airportCode}&type=${type}&continue=` + Date.now());
            const html = await response.text();

            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newContent = doc.querySelector('.table-body')?.parentElement;

            if (newContent) {
                scrollContainer.innerHTML = '';
                scrollContainer.appendChild(newContent);

                // ‚úÖ ‡∏£‡∏≠‡πÉ‡∏´‡πâ DOM update ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ scroll ‡πÑ‡∏õ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
                requestAnimationFrame(() => {
                    // scrollContainer.scrollTop = scrollContainer.scrollHeight;
                    scrollContainer.scrollTop = 0;
                });

                console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞ scroll ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß:', airportCode);
                renderRemarksAndRows();
            }
        } catch (err) {
            console.error('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', err);
        }
    }

    // function autoScroll() {
    //     if (paused) return;
    //     const maxScroll = scrollContainer.scrollHeight - scrollContainer.clientHeight;
    //     const currentScroll = scrollContainer.scrollTop;

    //     if ((direction === 1 && currentScroll >= maxScroll) ||
    //         (direction === -1 && currentScroll <= 0)) {
    //         paused = true;

    //         if (direction === 1) {
    //             // setTimeout(() => {
    //             //     direction *= -1;
    //             //     paused = false;
    //             //     requestAnimationFrame(autoScroll);
    //             // }, delay);
    //             fetchDepartures().then(() => {
    //                 paused = false;
    //                 requestAnimationFrame(autoScroll);
    //             });
    //         } else {
    //             // fetchDepartures().then(() => {
    //             //     setTimeout(() => {
    //             //         direction *= -1;
    //             //         paused = false;
    //             //         requestAnimationFrame(autoScroll);
    //             //     }, delay);
    //             // });
    //             setTimeout(() => {
    //                 direction *= -1;
    //                 paused = false;
    //                 requestAnimationFrame(autoScroll);
    //             }, delay);
    //         }
    //     } else {
    //         const scrollStep = direction === 1 ? scrollSpeedDown : scrollSpeedUp;
    //         scrollContainer.scrollTop += direction * scrollStep;
    //         requestAnimationFrame(autoScroll);
    //     }
    // }

    // function autoScroll() {
    //     if (paused) return;

    //     const maxScroll = scrollContainer.scrollHeight - scrollContainer.clientHeight;
    //     const currentScroll = scrollContainer.scrollTop;

    //     if (direction === 1 && currentScroll >= maxScroll) {
    //         paused = true;

    //         fetchDepartures().then(() => {
    //             setTimeout(() => {
    //                 paused = false;
    //                 requestAnimationFrame(autoScroll);
    //             }, delay); // ‚úÖ ‡∏´‡∏ô‡πà‡∏ß‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° scroll ‡πÉ‡∏´‡∏°‡πà
    //         });

    //     } else {
    //         const scrollStep = scrollSpeedDown;
    //         scrollContainer.scrollTop += scrollStep;
    //         requestAnimationFrame(autoScroll);
    //     }
    // }

    function autoScroll() {
        if (paused) return;

        const maxScroll = scrollContainer.scrollHeight - scrollContainer.clientHeight;
        const currentScroll = scrollContainer.scrollTop;

        if (currentScroll >= maxScroll) {
            paused = true;
            // setTimeout(() => {
            //     fetchDepartures().then(() => {
            //         paused = false;
            //         requestAnimationFrame(autoScroll);
            //     });
            // }, 5000);
            fetchDepartures().then(() => {
                // ‚úÖ Delay 5 ‡∏ß‡∏¥‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                setTimeout(() => {
                    paused = false;
                    requestAnimationFrame(autoScroll);
                }, 5000);
            });
        } else {
            scrollContainer.scrollTop += scrollSpeedDown;
            setTimeout(() => {
                requestAnimationFrame(autoScroll);
            }, 50); // ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô = ‡∏ä‡πâ‡∏≤‡∏•‡∏á ‡πÄ‡∏ä‡πà‡∏ô 20, 30
        }
    }

    function renderRemarksAndRows() {
        const remarkContainers = document.querySelectorAll('.remark-container');

        remarkContainers.forEach(function (container) {
            const rawText = container.textContent || container.innerText;
            if (!rawText || rawText.trim() === "") {
                container.innerHTML = "";
                return;
            }
            const parts = rawText.split('|');
            container.innerHTML = '';
            const selected = [];

            if (airportCode === "BKK") {
                if (parts.length >= 3) {
                    selected.push(parts[0].trim(), parts[2].trim());
                } else if (parts[0]?.trim()) {
                    selected.push(parts[0].trim());
                }
            } else if (["CNX", "HKT"].includes(airportCode)) {
                if (parts.length >= 4) {
                    selected.push(parts[0].trim(), parts[3].trim());
                } else if (parts[0]?.trim()) {
                    selected.push(parts[0].trim());
                }
            } else {
                if (parts[0]?.trim()) {
                    selected.push(parts[0].trim());
                }
            }

            selected.forEach(function (text) {
                const span = document.createElement('span');
                span.textContent = text;
                span.className = getRemarkClass(text);
                container.appendChild(span);
                container.appendChild(document.createTextNode(' '));
            });
        });

        document.querySelectorAll('.rowContainer').forEach(function (rowContainer) {
            const rowText = rowContainer.textContent || rowContainer.innerText;
            if (rowText.trim()) {
                const items = rowText.split(',');
                rowContainer.innerHTML = '';
                items.forEach(function (item) {
                    const span = document.createElement('span');
                    span.className = "text-center text-black bg-white rounded-lg p-2";
                    span.textContent = item.trim();
                    rowContainer.appendChild(span);
                    rowContainer.appendChild(document.createTextNode(' '));
                });
            }
        });
    }

    function getRemarkClass(text) {
        switch (text) {
            case "Ck-in Close": return "m-2 text-white px-2 py-1 text-[28px]";
            case "DELAYED": return "m-2 bg-white text-black px-2 py-1 rounded text-[28px]";
            case "CANCELLED": return "m-2 bg-blue-500 text-white px-2 py-1 rounded text-[28px]";
            case "Ck-in Open": return "m-2 bg-green-600 text-white px-2 py-1 rounded text-[28px]";
            case "DEPARTED": return "m-2 animate-pulse text-white px-2 py-1 rounded text-[28px]";
            default: return "m-2 text-white px-2 py-1 rounded text-[28px] flex justify-between items-center";
        }
    }
</script>


</html>